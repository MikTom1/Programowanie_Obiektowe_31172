@using BlazorApp1.Components.Database
@using BlazorApp1.Migrations
@using BlazorApp1.Models
@using MudBlazor

@using BlazorApp1.Services
@inject NavigationManager Nav
@inject ISnackbar Snackbar
@inject ProductService Prod
@inject SportShopDb Db
@inject IDialogService DialogService

<MudContainer  Class="mt-12">
    <MudPaper Elevation="12" Class="pa-6" Style="width:900px;height: 450px">
        
    
        <MudForm @ref="form" Style="width: 800px;height: 300px;">
            <MudTextField Label="Nazwa" 
                          ShrinkLabel="true"
                          @bind-Value="productName"
                          Required="true"
                          Class="mb-3"
                          RequiredError="Podaj nazwe produktu"/>
            <MudNumericField T="decimal"
                             Label="PriceNet" 
                             ShrinkLabel="true"
                             @bind-Value="price"
                             Class="mb-4"
                             Min="0"
                             Step="0.01m"
                             RequiredError="Podaj Cene netto /0.0"/>
            <MudTextField Label="Kategoria" 
                          ShrinkLabel="true"
                          @bind-Value="category"
                          Required="true"
                          Class="mb-4"
                          RequiredError="Podaj kategorie"/>
            
        </MudForm> 
        
    </MudPaper>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Style="width: 100px" OnClick="@(SaveChanges)"
               ButtonType="ButtonType.Button">Zatwierdź</MudButton>
    <MudButton Variant="Variant.Filled"Color="Color.Info" OnClick="@Cancel">
        Anuluj
    </MudButton>
</MudContainer>
@code {
    [Parameter] 
    public int productId { get; set; }
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = default!;
    private MudForm form;
    private string productName;
    private decimal price;
    private string category;
    
    protected async override Task OnInitializedAsync()
    {
        var product = await Prod.ReturnProductIDAsync(productId);
        productName = product.ProductName;
        price = product.PriceNet;
        category = product.Category;
       
    }
    
    private async Task SaveChanges()
    {
        var _product = await Prod.ReturnProductIDAsync(productId);
        _product.ProductName = productName;
        _product.PriceNet = price;
        _product.Category =category ;
        
        await Db.SaveChangesAsync();
        MudDialog.Close(DialogResult.Ok(_product)); 
    }
    private void Cancel()
    {
        MudDialog.Cancel();
    }
}